<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Measurement Chains • kwb.geosalz</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Measurement Chains">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">kwb.geosalz</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/data-availability_fri.html">Data Availability Waterworks Friedrichshagen</a></li>
    <li><a class="dropdown-item" href="../articles/emshoff91.html">Emshoff 91</a></li>
    <li><a class="dropdown-item" href="../articles/hydrochemistry.html">Hydrochemistry</a></li>
    <li><a class="dropdown-item" href="../articles/measurement-chains.html">Measurement Chains</a></li>
    <li><a class="dropdown-item" href="../articles/wasserportal.html">Wasserportal</a></li>
    <li><a class="dropdown-item" href="../articles/workflow.html">Workflow</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/KWB-R/kwb.geosalz/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="measurement-chains_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="measurement-chains_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="measurement-chains_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="measurement-chains_files/datatables-binding-0.33/datatables.js"></script><link href="measurement-chains_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="measurement-chains_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="measurement-chains_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="measurement-chains_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="measurement-chains_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Measurement Chains</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/KWB-R/kwb.geosalz/blob/main/vignettes/measurement-chains.Rmd" class="external-link"><code>vignettes/measurement-chains.Rmd</code></a></small>
      <div class="d-none name"><code>measurement-chains.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>One <em>measurement chain</em> consists of six sensors that are
placed in one production well, but at different filter depths. In total,
three measurement chains will be installed in three different production
wells.</p>
<p>Table 1 below lists all individual sensors. The number of the sensor
within the well is given in column <code>sensor_endnummer</code>. The
identifier of the production well that the sensor is located in is given
in column <code>brunnen_nummer</code>.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"none","vertical":false,"caption":"<caption>Table 1: Metadata on Measurement Chains. Each row represents a sensor.<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],["K","K","K","K","K","K","K","K","K","K","K","K","K","K","K","K","K","K"],[9,9,9,9,9,9,10,10,10,10,10,10,13,13,13,13,13,13],[400,400,400,400,400,400,600,600,600,600,600,600,600,600,600,600,600,600],["über Filter","über Filter","über Filter","über Filter","über Filter","über Filter","unter Filter","unter Filter","unter Filter","unter Filter","unter Filter","unter Filter","unter Filter","unter Filter","unter Filter","unter Filter","unter Filter","unter Filter"],["unter Pumpe","unter Pumpe","unter Pumpe","unter Pumpe","unter Pumpe","unter Pumpe","über Pumpe (am Steigrohr)","über Pumpe (am Steigrohr)","über Pumpe (am Steigrohr)","über Pumpe (am Steigrohr)","über Pumpe (am Steigrohr)","über Pumpe (am Steigrohr)","über Pumpe (am Steigrohr)","über Pumpe (am Steigrohr)","über Pumpe (am Steigrohr)","über Pumpe (am Steigrohr)","über Pumpe (am Steigrohr)","über Pumpe (am Steigrohr)"],[21,21,21,21,21,21,11,11,11,11,11,11,12,12,12,12,12,12],[27,27,27,27,27,27,18,18,18,18,18,18,20,20,20,20,20,20],[4182018,4182017,4182016,4182015,4182014,4182013,4182006,4182005,4182004,4182003,4182002,4182001,4182012,4182011,4182010,4182009,4182008,4182007],[8,7,6,5,4,3,6,5,4,3,2,1,2,1,0,9,8,7],[21.5,22.5,23.5,24.5,25.5,26.5,11.5,12.7,13.9,15.1,16.3,17.5,12.5,13.9,15.3,16.7,18.1,19.5]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>galerie<\/th>\n      <th>brunnen_nummer<\/th>\n      <th>dn<\/th>\n      <th>einbau_pumpe<\/th>\n      <th>einbau_messkette<\/th>\n      <th>filteroberkante_muGOK<\/th>\n      <th>filterunterkante_muGOK<\/th>\n      <th>sensor_id<\/th>\n      <th>sensor_endnummer<\/th>\n      <th>einbau_sensor_muGOK<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,6,7,8,9,10]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"galerie","targets":1},{"name":"brunnen_nummer","targets":2},{"name":"dn","targets":3},{"name":"einbau_pumpe","targets":4},{"name":"einbau_messkette","targets":5},{"name":"filteroberkante_muGOK","targets":6},{"name":"filterunterkante_muGOK","targets":7},{"name":"sensor_id","targets":8},{"name":"sensor_endnummer","targets":9},{"name":"einbau_sensor_muGOK","targets":10}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Each sensor (type: <em>WLF05</em>, <strong>TODO</strong>:
add-link-to-factsheet-on-kwb-cloud) measures two parameters with the
following characteristics:</p>
<ul>
<li>electrical conductivity:
<ul>
<li>measurement range: 0 - 20 mS</li>
<li>measurement range detection: automatic</li>
<li>typical accuracy: +/- 1.5 % of measurement value</li>
</ul>
</li>
<li>temperature:
<ul>
<li>measurement range: 0 - 50 degree Celsius</li>
<li>measurement resolution: 0.1 Kelvin</li>
<li>typical accuracy: &lt;= 0.1 Kelvin</li>
</ul>
</li>
</ul>
<p>The maximum temporal resolution that a sensor can provide is “every
second”. Within the GeoSalz project, measurements are taken every 5
minutes. This should be sufficient to detect potential salinity shifts
that are caused by changes in the pumping regime.</p>
</div>
<div class="section level2">
<h2 id="data-management">Data Management<a class="anchor" aria-label="anchor" href="#data-management"></a>
</h2>
<div class="section level3">
<h3 id="define-paths">Define Paths<a class="anchor" aria-label="anchor" href="#define-paths"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define paths to directories, using &lt;placeholder&gt; replacements</span></span>
<span><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu">kwb.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.utils/man/resolve.html" class="external-link">resolve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co"># Local temporary directory</span></span>
<span>  local_dir <span class="op">=</span> <span class="fu">kwb.geosalz</span><span class="fu">:::</span><span class="fu">temp_dir</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># Target directory for downloaded measurement chain files (.csv)</span></span>
<span>  download_dir <span class="op">=</span> <span class="st">"&lt;local_dir&gt;/download"</span>, </span>
<span> </span>
<span>  <span class="co"># Local directory for aggregated data (.csv and .zip)</span></span>
<span>  export_dir <span class="op">=</span> <span class="st">"&lt;local_dir&gt;/export"</span>, </span>
<span> </span>
<span>  <span class="co"># KWB cloud directory to which data in "export_dir" is uploaded</span></span>
<span>  upload_dir <span class="op">=</span> <span class="st">"projects/GeoSalz/Monitoring/messketten"</span>,</span>
<span>  </span>
<span>  <span class="co"># KWB cloud directory with latest BWB well operation data</span></span>
<span>  well_operation <span class="op">=</span> <span class="st">"&lt;upload_dir&gt;/BWB_Brunnen_Prozessdaten"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; The directory "C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz" was created.</span></span>
<span></span>
<span><span class="co"># Print all paths</span></span>
<span><span class="va">paths</span></span>
<span><span class="co">#&gt; $local_dir</span></span>
<span><span class="co">#&gt; [1] "C:\\Users\\RUNNER~1\\AppData\\Local\\Temp/R_kwb.geosalz"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $download_dir</span></span>
<span><span class="co">#&gt; [1] "C:\\Users\\RUNNER~1\\AppData\\Local\\Temp/R_kwb.geosalz/download"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $export_dir</span></span>
<span><span class="co">#&gt; [1] "C:\\Users\\RUNNER~1\\AppData\\Local\\Temp/R_kwb.geosalz/export"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $upload_dir</span></span>
<span><span class="co">#&gt; [1] "projects/GeoSalz/Monitoring/messketten"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $well_operation</span></span>
<span><span class="co">#&gt; [1] "projects/GeoSalz/Monitoring/messketten/BWB_Brunnen_Prozessdaten"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-sftp-login">Define SFTP Login<a class="anchor" aria-label="anchor" href="#define-sftp-login"></a>
</h3>
<p>Run <code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_environ()</a></code> to edit the
<code>.Renviron</code> file. The file defines environment variables that
are to be made accessible during an R session. Add the following three
rows, defining three more environment variables, to the file. The
environment variables are required to log in to the SFTP server from
which input data are downloaded.</p>
<pre><code>MESSKETTEN_SERVER=&lt;sftp_url&gt;
MESSKETTEN_USER=&lt;sftp_username&gt;
MESSKETTEN_PASSWORD=&lt;sftp_userpassword&gt;</code></pre>
<p>Replace the placeholders <code>&lt;sftp_url&gt;</code>,
<code>&lt;sftp_username&gt;</code>,
<code>&lt;sftp_userpassword&gt;</code> with the URL, the user name, and
the password, respectively, that are required to get access to the SFTP
server.</p>
<p>Save the <code>.Renviron</code> file and restart the R session
(e.g. with “Session/Restart R” from the menu in RStudio) to make the
environment variables available in R.</p>
<p>In case that the SFTP login credentials are correct, the code below
should work. It downloads the measurement chains data (i.e. parameters
electrical conductivity and temperature) from the SFTP server to a
user-defined directory on your local device.</p>
</div>
<div class="section level3">
<h3 id="data-download">Data Download<a class="anchor" aria-label="anchor" href="#data-download"></a>
</h3>
<div class="section level4">
<h4 id="what-files-are-available-on-the-sftp-server">What files are available on the SFTP server?<a class="anchor" aria-label="anchor" href="#what-files-are-available-on-the-sftp-server"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Metadata of measurement chains (see also Table 1 above)</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu">kwb.geosalz</span><span class="fu">::</span><span class="fu"><a href="../reference/get_measurementchains_metadata.html">get_measurementchains_metadata</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span>
<span><span class="co">#&gt; spc_tbl_ [18 × 10] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ galerie               : chr [1:18] "K" "K" "K" "K" ...</span></span>
<span><span class="co">#&gt;  $ brunnen_nummer        : int [1:18] 9 9 9 9 9 9 10 10 10 10 ...</span></span>
<span><span class="co">#&gt;  $ dn                    : int [1:18] 400 400 400 400 400 400 600 600 600 600 ...</span></span>
<span><span class="co">#&gt;  $ einbau_pumpe          : chr [1:18] "über Filter" "über Filter" "über Filter" "über Filter" ...</span></span>
<span><span class="co">#&gt;  $ einbau_messkette      : chr [1:18] "unter Pumpe" "unter Pumpe" "unter Pumpe" "unter Pumpe" ...</span></span>
<span><span class="co">#&gt;  $ filteroberkante_muGOK : num [1:18] 21 21 21 21 21 21 11 11 11 11 ...</span></span>
<span><span class="co">#&gt;  $ filterunterkante_muGOK: num [1:18] 27 27 27 27 27 27 18 18 18 18 ...</span></span>
<span><span class="co">#&gt;  $ sensor_id             : int [1:18] 4182018 4182017 4182016 4182015 4182014 4182013 4182006 4182005 4182004 4182003 ...</span></span>
<span><span class="co">#&gt;  $ sensor_endnummer      : int [1:18] 8 7 6 5 4 3 6 5 4 3 ...</span></span>
<span><span class="co">#&gt;  $ einbau_sensor_muGOK   : num [1:18] 21.5 22.5 23.5 24.5 25.5 26.5 11.5 12.7 13.9 15.1 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "spec")=</span></span>
<span><span class="co">#&gt;   .. cols(</span></span>
<span><span class="co">#&gt;   ..   galerie = <span style="color: #BB0000;">col_character()</span>,</span></span>
<span><span class="co">#&gt;   ..   brunnen_nummer = <span style="color: #00BB00;">col_integer()</span>,</span></span>
<span><span class="co">#&gt;   ..   dn = <span style="color: #00BB00;">col_integer()</span>,</span></span>
<span><span class="co">#&gt;   ..   einbau_pumpe = <span style="color: #BB0000;">col_character()</span>,</span></span>
<span><span class="co">#&gt;   ..   einbau_messkette = <span style="color: #BB0000;">col_character()</span>,</span></span>
<span><span class="co">#&gt;   ..   filteroberkante_muGOK = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   ..   filterunterkante_muGOK = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   ..   sensor_id = <span style="color: #00BB00;">col_integer()</span>,</span></span>
<span><span class="co">#&gt;   ..   sensor_endnummer = <span style="color: #00BB00;">col_integer()</span>,</span></span>
<span><span class="co">#&gt;   ..   einbau_sensor_muGOK = <span style="color: #00BB00;">col_double()</span></span></span>
<span><span class="co">#&gt;   .. )</span></span>
<span><span class="co">#&gt;  - attr(*, "problems")=&lt;externalptr&gt;</span></span>
<span></span>
<span><span class="co"># Information on available measurement chain files on SFTP server</span></span>
<span><span class="va">mc_files</span> <span class="op">&lt;-</span> <span class="fu">kwb.geosalz</span><span class="fu">::</span><span class="fu"><a href="../reference/get_measurementchains_files.html">get_measurementchains_files</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mc_files</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    14723 obs. of  16 variables:</span></span>
<span><span class="co">#&gt;  $ rights          : chr  "-rw-r--r--" "-rw-r--r--" "-rw-r--r--" "-rw-r--r--" ...</span></span>
<span><span class="co">#&gt;  $ links           : chr  "1" "1" "1" "1" ...</span></span>
<span><span class="co">#&gt;  $ ownername       : chr  "1011" "1011" "1011" "1011" ...</span></span>
<span><span class="co">#&gt;  $ ownergroup      : chr  "1002" "1002" "1002" "1002" ...</span></span>
<span><span class="co">#&gt;  $ filesize        : chr  "4559" "4559" "4559" "4559" ...</span></span>
<span><span class="co">#&gt;  $ t1              : chr  "Oct" "Oct" "Oct" "Oct" ...</span></span>
<span><span class="co">#&gt;  $ t2              : chr  "24" "24" "24" "25" ...</span></span>
<span><span class="co">#&gt;  $ t3              : chr  "2022" "2022" "2022" "2022" ...</span></span>
<span><span class="co">#&gt;  $ sftp_path       : chr  "K09/4182013-2022-10-22-0606.csv" "K09/4182013-2022-10-23-0606.csv" "K09/4182013-2022-10-24-0606.csv" "K09/4182013-2022-10-25-0606.csv" ...</span></span>
<span><span class="co">#&gt;  $ type            : chr  "file" "file" "file" "file" ...</span></span>
<span><span class="co">#&gt;  $ galerie         : chr  "K" "K" "K" "K" ...</span></span>
<span><span class="co">#&gt;  $ brunnen_nummer  : int  9 9 9 9 9 9 9 9 9 9 ...</span></span>
<span><span class="co">#&gt;  $ prefix          : chr  "" "" "" "" ...</span></span>
<span><span class="co">#&gt;  $ sensor_id       : int  4182013 4182013 4182013 4182013 4182013 4182013 4182013 4182013 4182013 4182013 ...</span></span>
<span><span class="co">#&gt;  $ sensor_endnummer: int  3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span><span class="co">#&gt;  $ datum_uhrzeit   : POSIXct, format: "2022-10-22 06:06:00" "2022-10-23 06:06:00" ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mc_files</span><span class="op">)</span></span>
<span><span class="co">#&gt;       rights links ownername ownergroup filesize  t1 t2   t3</span></span>
<span><span class="co">#&gt; 1 -rw-r--r--     1      1011       1002     4559 Oct 24 2022</span></span>
<span><span class="co">#&gt; 2 -rw-r--r--     1      1011       1002     4559 Oct 24 2022</span></span>
<span><span class="co">#&gt; 3 -rw-r--r--     1      1011       1002     4559 Oct 24 2022</span></span>
<span><span class="co">#&gt; 4 -rw-r--r--     1      1011       1002     4559 Oct 25 2022</span></span>
<span><span class="co">#&gt; 5 -rw-r--r--     1      1011       1002     4559 Oct 26 2022</span></span>
<span><span class="co">#&gt; 6 -rw-r--r--     1      1011       1002     4559 Oct 27 2022</span></span>
<span><span class="co">#&gt;                         sftp_path type galerie brunnen_nummer prefix sensor_id</span></span>
<span><span class="co">#&gt; 1 K09/4182013-2022-10-22-0606.csv file       K              9          4182013</span></span>
<span><span class="co">#&gt; 2 K09/4182013-2022-10-23-0606.csv file       K              9          4182013</span></span>
<span><span class="co">#&gt; 3 K09/4182013-2022-10-24-0606.csv file       K              9          4182013</span></span>
<span><span class="co">#&gt; 4 K09/4182013-2022-10-25-0606.csv file       K              9          4182013</span></span>
<span><span class="co">#&gt; 5 K09/4182013-2022-10-26-0606.csv file       K              9          4182013</span></span>
<span><span class="co">#&gt; 6 K09/4182013-2022-10-27-0606.csv file       K              9          4182013</span></span>
<span><span class="co">#&gt;   sensor_endnummer       datum_uhrzeit</span></span>
<span><span class="co">#&gt; 1                3 2022-10-22 06:06:00</span></span>
<span><span class="co">#&gt; 2                3 2022-10-23 06:06:00</span></span>
<span><span class="co">#&gt; 3                3 2022-10-24 06:06:00</span></span>
<span><span class="co">#&gt; 4                3 2022-10-25 06:06:00</span></span>
<span><span class="co">#&gt; 5                3 2022-10-26 06:06:00</span></span>
<span><span class="co">#&gt; 6                3 2022-10-27 06:06:00</span></span>
<span></span>
<span><span class="co"># All paths to files on the SFTP server</span></span>
<span><span class="va">all_paths</span> <span class="op">&lt;-</span> <span class="fu">kwb.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.utils/man/selectColumns.html" class="external-link">selectColumns</a></span><span class="op">(</span><span class="va">mc_files</span>, <span class="st">"sftp_path"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="what-data-are-already-available-on-the-nextcloud-server">What data are already available on the Nextcloud server?<a class="anchor" aria-label="anchor" href="#what-data-are-already-available-on-the-nextcloud-server"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download existing data from the Nextcloud server. NULL is returned if there is</span></span>
<span><span class="co"># no file "mc_data.zip" in the Nextcloud folder </span></span>
<span><span class="co"># "projects/GeoSalz/Monitoring/messketten"</span></span>
<span><span class="va">old_data</span> <span class="op">&lt;-</span> <span class="fu">kwb.geosalz</span><span class="fu">::</span><span class="fu"><a href="../reference/get_measurement_chain_data_on_cloud.html">get_measurement_chain_data_on_cloud</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; The directory "~/../Downloads/nextcloud_173c5abe15af" was created.</span></span>
<span><span class="co">#&gt; Downloading remote.php/dav/files/hsonne/projects/GeoSalz/Monitoring/messketten/mc_data.zip ... ok. (0.81 secs)</span></span>
<span><span class="co">#old_data &lt;- NULL</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="what-files-need-to-be-downloaded-from-the-sftp-server">What files need to be downloaded from the SFTP server?<a class="anchor" aria-label="anchor" href="#what-files-need-to-be-downloaded-from-the-sftp-server"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Determine the SFTP paths of the files to be downloaded. Download all available</span></span>
<span><span class="co"># files if there was no data on the Nextcloud yet. Otherwise, download only</span></span>
<span><span class="co"># those files that have been added to the SFTP server since when this script was</span></span>
<span><span class="co"># run the last time.</span></span>
<span><span class="va">new_paths</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">old_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">all_paths</span></span>
<span>  </span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Get SFTP paths from which data were originally retrieved</span></span>
<span>  <span class="va">old_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu">kwb.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.utils/man/selectColumns.html" class="external-link">selectColumns</a></span><span class="op">(</span><span class="va">old_data</span>, <span class="st">"file"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Determine the paths to the new files that need to be downloaded</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">all_paths</span>, <span class="va">old_paths</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="download-the-new-files-from-the-sftp-server">Download the new files from the SFTP server<a class="anchor" aria-label="anchor" href="#download-the-new-files-from-the-sftp-server"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If there are new files to download, download them.</span></span>
<span><span class="va">csv_files</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">new_paths</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Download only the new measurement chain files (.csv) from the SFTP server</span></span>
<span>  <span class="fu">kwb.geosalz</span><span class="fu">::</span><span class="fu"><a href="../reference/download_measurementchains_data.html">download_measurementchains_data</a></span><span class="op">(</span></span>
<span>    sftp_paths <span class="op">=</span> <span class="va">new_paths</span>,</span>
<span>    target_directory <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">download_dir</span>,</span>
<span>    debug <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span> <span class="co"># else NULL implicitly</span></span>
<span><span class="co">#&gt; The directory "C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/download" was created.</span></span>
<span><span class="co">#&gt; Download 18 measurement chains files (using 3 CPU cores) to C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/download ... ok. (18.33 secs)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">csv_files</span><span class="op">)</span></span>
<span><span class="co">#&gt;  chr [1:18] "C:\\Users\\RUNNER~1\\AppData\\Local\\Temp/R_kwb.geosalz/download/K09/4182013-2025-01-30-0507.csv" ...</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="data-import">Data Import<a class="anchor" aria-label="anchor" href="#data-import"></a>
</h3>
<p>The following code imports the downloaded measurement chains files
(.csv) into R:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set the current data to the old data (may be NULL)</span></span>
<span><span class="va">mc_data</span> <span class="op">&lt;-</span> <span class="va">old_data</span></span>
<span></span>
<span><span class="co"># If new files have been downloaded, import them into R</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">csv_files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Import csv files using multiple CPU cores</span></span>
<span>  <span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu">kwb.geosalz</span><span class="fu">::</span><span class="fu"><a href="../reference/read_measurementchains_data.html">read_measurementchains_data</a></span><span class="op">(</span></span>
<span>    <span class="va">csv_files</span>,</span>
<span>    run_parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    debug <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Combine the new data with the existing data and reorder</span></span>
<span>  <span class="va">mc_data</span> <span class="op">&lt;-</span> <span class="va">mc_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">new_data</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">kwb.geosalz</span><span class="fu">::</span><span class="fu"><a href="../reference/order_measurement_chain_data.html">order_measurement_chain_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Importing 18 measurement chains files (using 3 CPU cores) ... ok. (2.20 secs) </span></span>
<span><span class="co">#&gt; Filtering out 'lab' measurements before '2022-09-27 11:00:00' (installation in K10) ... ok. (0.00 secs)</span></span></code></pre></div>
<p>The following datasets were imported into R or already available in
R:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mc_data_stats</span> <span class="op">&lt;-</span> <span class="va">mc_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kwb.geosalz</span><span class="fu">::</span><span class="fu"><a href="../reference/get_measurmentchains_data_stats.html">get_measurmentchains_data_stats</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span></span>
<span>    <span class="va">.data</span><span class="op">$</span><span class="va">parameter</span>, </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">sensor_id</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>These cover the time period from 2022-09-27 11:00:00 to 2025-01-29
23:00:00 with a total of 205438 samples.</p>
</div>
<div class="section level3">
<h3 id="data-export">Data Export<a class="anchor" aria-label="anchor" href="#data-export"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">debug</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span><span class="co"># Export "mc_data" to csv file</span></span>
<span><span class="va">data_csv_path</span> <span class="op">&lt;-</span> <span class="fu">kwb.geosalz</span><span class="fu">::</span><span class="fu"><a href="../reference/write_measurementchains_data.html">write_measurementchains_data</a></span><span class="op">(</span></span>
<span>  <span class="va">mc_data</span>,</span>
<span>  target_directory <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">export_dir</span>,</span>
<span>  to_zip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  debug <span class="op">=</span> <span class="va">debug</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Exporting provided dataset 'mc_data' to 'C:/Users/RUNNER~1/AppData/Local/Temp/R_kwb.geosalz/export/mc_data_20220927-110000TZ+01_20250129-230000TZ+01.csv' ... ok. (2.77 secs)</span></span>
<span></span>
<span><span class="va">size_data_csv</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_info.html" class="external-link">file_size</a></span><span class="op">(</span><span class="va">data_csv_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export "mc_data" to zip file (~10x less disk space for test dataset)</span></span>
<span><span class="va">data_zip_path</span> <span class="op">&lt;-</span> <span class="fu">kwb.geosalz</span><span class="fu">::</span><span class="fu"><a href="../reference/write_measurementchains_data.html">write_measurementchains_data</a></span><span class="op">(</span></span>
<span>  <span class="va">mc_data</span>,</span>
<span>  target_directory <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">export_dir</span>,</span>
<span>  to_zip <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  debug <span class="op">=</span> <span class="va">debug</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Exporting provided dataset 'mc_data' to 'C:/Users/RUNNER~1/AppData/Local/Temp/R_kwb.geosalz/export/mc_data_20220927-110000TZ+01_20250129-230000TZ+01.csv' ... ok. (2.76 secs) </span></span>
<span><span class="co">#&gt; Exporting provided dataset 'mc_data' to 'C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data.zip' and delete intermediate 'C:/Users/RUNNER~1/AppData/Local/Temp/R_kwb.geosalz/export/mc_data_20220927-110000TZ+01_20250129-230000TZ+01.csv' ... ok. (0.21 secs)</span></span>
<span></span>
<span><span class="va">size_data_zip</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_info.html" class="external-link">file_size</a></span><span class="op">(</span><span class="va">data_zip_path</span><span class="op">)</span></span>
<span><span class="va">size_data_csv</span> <span class="op">/</span> <span class="va">size_data_zip</span></span>
<span><span class="co">#&gt; 19.7</span></span>
<span></span>
<span><span class="va">extract_data_timeperiod</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">kwb.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.utils/man/replaceFileExtension.html" class="external-link">replaceFileExtension</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="st">"^mc[-|_]data"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define helper function to write a csv file in a target directory</span></span>
<span><span class="va">write_csv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">postfix</span> <span class="op">=</span> <span class="st">""</span>, <span class="va">target_dir</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html" class="external-link">dir_create</a></span><span class="op">(</span><span class="va">target_dir</span><span class="op">)</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/deparse.html" class="external-link">deparse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">target_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">postfix</span>,  <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">file</span><span class="op">)</span></span>
<span>  <span class="va">file</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">postfix</span> <span class="op">&lt;-</span> <span class="fu">extract_data_timeperiod</span><span class="op">(</span><span class="va">data_zip_path</span><span class="op">)</span></span>
<span><span class="va">target_dir</span> <span class="op">&lt;-</span> <span class="va">paths</span><span class="op">$</span><span class="va">export_dir</span></span>
<span></span>
<span><span class="co"># Export data and metadata to csv files</span></span>
<span><span class="va">stats_path</span> <span class="op">&lt;-</span> <span class="fu">write_csv</span><span class="op">(</span><span class="va">mc_data_stats</span>, <span class="va">postfix</span>, <span class="va">target_dir</span><span class="op">)</span></span>
<span><span class="va">metadata_path</span> <span class="op">&lt;-</span> <span class="fu">write_csv</span><span class="op">(</span><span class="va">metadata</span>, <span class="va">postfix</span>, <span class="va">target_dir</span><span class="op">)</span></span>
<span><span class="va">files_path</span> <span class="op">&lt;-</span> <span class="fu">write_csv</span><span class="op">(</span><span class="va">mc_files</span>, <span class="va">postfix</span>, <span class="va">target_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define function that plots data to a pdf file</span></span>
<span><span class="va">plot_to_pdf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mc_data</span>, <span class="va">para</span>, <span class="va">target_dir</span> <span class="op">=</span> <span class="st">"."</span>, <span class="va">debug</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu">kwb.geosalz</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_measurementchains.html">plot_measurementchains</a></span><span class="op">(</span><span class="va">mc_data</span>, <span class="va">para</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">plots</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">path</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">target_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"mc_data_%s.pdf"</span>, <span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu">kwb.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.utils/man/catAndRun.html" class="external-link">catAndRun</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Writting '%s' to '%s'"</span>, <span class="va">name</span>, <span class="va">path</span><span class="op">)</span>,</span>
<span>      expr <span class="op">=</span> <span class="op">{</span></span>
<span>        <span class="fu">kwb.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.utils/man/preparePdf.html" class="external-link">preparePdf</a></span><span class="op">(</span><span class="va">path</span>, width.cm <span class="op">=</span> <span class="fl">25</span>, height.cm <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plots</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">path</span></span>
<span>      <span class="op">}</span>, </span>
<span>      dbg <span class="op">=</span> <span class="va">debug</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">pdf_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">plot_to_pdf</span><span class="op">(</span><span class="va">mc_data</span>, <span class="st">"Leitfaehigkeit"</span>, <span class="va">paths</span><span class="op">$</span><span class="va">export_dir</span><span class="op">)</span>, </span>
<span>  <span class="fu">plot_to_pdf</span><span class="op">(</span><span class="va">mc_data</span>, <span class="st">"Temperatur"</span>, <span class="va">paths</span><span class="op">$</span><span class="va">export_dir</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Writting 'Leitfaehigkeit_K10' to 'C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Leitfaehigkeit_K10.pdf' ...</span></span>
<span><span class="co">#&gt; ok. (1.01 secs) </span></span>
<span><span class="co">#&gt; Writting 'Leitfaehigkeit_K13' to 'C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Leitfaehigkeit_K13.pdf' ...</span></span>
<span><span class="co">#&gt; ok. (0.75 secs) </span></span>
<span><span class="co">#&gt; Writting 'Leitfaehigkeit_K09' to 'C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Leitfaehigkeit_K09.pdf' ...</span></span>
<span><span class="co">#&gt; ok. (0.77 secs) </span></span>
<span><span class="co">#&gt; Writting 'Temperatur_K10' to 'C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Temperatur_K10.pdf' ...</span></span>
<span><span class="co">#&gt; ok. (0.79 secs) </span></span>
<span><span class="co">#&gt; Writting 'Temperatur_K13' to 'C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Temperatur_K13.pdf' ...</span></span>
<span><span class="co">#&gt; ok. (0.60 secs) </span></span>
<span><span class="co">#&gt; Writting 'Temperatur_K09' to 'C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Temperatur_K09.pdf' ...</span></span>
<span><span class="co">#&gt; ok. (0.64 secs)</span></span>
<span></span>
<span><span class="va">data_zip_path</span></span>
<span><span class="co">#&gt; [1] "C:\\Users\\RUNNER~1\\AppData\\Local\\Temp/R_kwb.geosalz/export/mc_data.zip"</span></span></code></pre></div>
<p>The file size of the
mc_data_20220927-110000TZ+01_20250129-230000TZ+01.csv file is 19.7 times
larger compared to compressing it into mc_data.zip.</p>
</div>
<div class="section level3">
<h3 id="data-upload">Data Upload<a class="anchor" aria-label="anchor" href="#data-upload"></a>
</h3>
<p>In order to automate the data management process the <a href="#data-export">exported data</a> these data will be uploaded to a
restricted shared folder on the KWB cloud. For doing so the following
environment variables need to be defined in case the code below should
be run from a client computer. However, as these variables are defined
in a GitHub actions workflow there is no need to do this locally.</p>
<pre><code><span><span class="va">NEXTCLOUD_URL</span> <span class="op">=</span> <span class="st">"https://&lt;replace-with-kwb-cloud-url&gt;"</span></span>
<span><span class="va">NEXTCLOUD_USER</span> <span class="op">=</span> <span class="st">"&lt;your-kwb-cloud-username&gt;"</span> <span class="co"># your username</span></span>
<span><span class="va">NEXTCLOUD_PASSWORD</span> <span class="op">=</span> <span class="st">"your-nextcloud-app-password"</span> <span class="co">### see details below</span></span></code></pre>
<p>Subsequently the following code is run for uploading the data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List paths of files to upload explicitly</span></span>
<span><span class="va">upload_files</span> <span class="op">&lt;-</span> <span class="fu">kwb.geosalz</span><span class="fu">:::</span><span class="fu">exclude_missing_files</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="va">stats_path</span>, </span>
<span>  <span class="va">pdf_files</span>,</span>
<span>  <span class="va">metadata_path</span>, </span>
<span>  <span class="va">files_path</span>,</span>
<span>  <span class="va">data_zip_path</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">file</span> <span class="kw">in</span> <span class="va">upload_files</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">kwb.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.utils/man/catAndRun.html" class="external-link">catAndRun</a></span><span class="op">(</span></span>
<span>    messageText <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Uploading file"</span>, <span class="va">file</span><span class="op">)</span>,</span>
<span>    expr <span class="op">=</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">kwb.nextcloud</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.nextcloud/man/upload_file.html" class="external-link">upload_file</a></span><span class="op">(</span></span>
<span>      file <span class="op">=</span> <span class="va">file</span>, </span>
<span>      target_path <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">upload_dir</span></span>
<span>    <span class="op">)</span><span class="op">)</span>,</span>
<span>    dbg <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Uploading file C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_stats.csv ... Uploading</span></span>
<span><span class="co">#&gt;   C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_stats.csv</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (1.43 secs) </span></span>
<span><span class="co">#&gt; ok. (1.76 secs) </span></span>
<span><span class="co">#&gt; Uploading file C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Leitfaehigkeit_K10.pdf ... Uploading</span></span>
<span><span class="co">#&gt;   C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Leitfaehigkeit_K10.pdf</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (2.18 secs) </span></span>
<span><span class="co">#&gt; ok. (2.50 secs) </span></span>
<span><span class="co">#&gt; Uploading file C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Leitfaehigkeit_K13.pdf ... Uploading</span></span>
<span><span class="co">#&gt;   C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Leitfaehigkeit_K13.pdf</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (1.26 secs) </span></span>
<span><span class="co">#&gt; ok. (1.57 secs) </span></span>
<span><span class="co">#&gt; Uploading file C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Leitfaehigkeit_K09.pdf ... Uploading</span></span>
<span><span class="co">#&gt;   C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Leitfaehigkeit_K09.pdf</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (1.07 secs) </span></span>
<span><span class="co">#&gt; ok. (1.39 secs) </span></span>
<span><span class="co">#&gt; Uploading file C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Temperatur_K10.pdf ... Uploading</span></span>
<span><span class="co">#&gt;   C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Temperatur_K10.pdf</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (1.16 secs) </span></span>
<span><span class="co">#&gt; ok. (1.52 secs) </span></span>
<span><span class="co">#&gt; Uploading file C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Temperatur_K13.pdf ... Uploading</span></span>
<span><span class="co">#&gt;   C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Temperatur_K13.pdf</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (1.26 secs) </span></span>
<span><span class="co">#&gt; ok. (1.59 secs) </span></span>
<span><span class="co">#&gt; Uploading file C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Temperatur_K09.pdf ... Uploading</span></span>
<span><span class="co">#&gt;   C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data_Temperatur_K09.pdf</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (1.11 secs) </span></span>
<span><span class="co">#&gt; ok. (1.43 secs) </span></span>
<span><span class="co">#&gt; Uploading file C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/metadata.csv ... Uploading</span></span>
<span><span class="co">#&gt;   C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/metadata.csv</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (0.81 secs) </span></span>
<span><span class="co">#&gt; ok. (1.15 secs) </span></span>
<span><span class="co">#&gt; Uploading file C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_files.csv ... Uploading</span></span>
<span><span class="co">#&gt;   C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_files.csv</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (1.14 secs) </span></span>
<span><span class="co">#&gt; ok. (1.48 secs) </span></span>
<span><span class="co">#&gt; Uploading file C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data.zip ... Uploading</span></span>
<span><span class="co">#&gt;   C:\Users\RUNNER~1\AppData\Local\Temp/R_kwb.geosalz/export/mc_data.zip</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (0.95 secs) </span></span>
<span><span class="co">#&gt; ok. (1.26 secs)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-well-operation-data-from-cloud">Download Well Operation Data from Cloud<a class="anchor" aria-label="anchor" href="#download-well-operation-data-from-cloud"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">mc_dat</span> <span class="op">&lt;-</span> <span class="va">mc_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sensor_id"</span>, <span class="st">"einbau_sensor_muGOK"</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"sensor_id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">mc_files</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sftp_path</span>, <span class="va">galerie</span>, <span class="va">brunnen_nummer</span><span class="op">)</span>,</span>
<span>                   by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"sftp_path"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">well_op_file</span> <span class="op">&lt;-</span> <span class="fu">kwb.nextcloud</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.nextcloud/man/list_files.html" class="external-link">list_files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">well_operation</span>,</span>
<span>                                          full_info <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">lastmodified</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">lastmodified</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Listing projects/GeoSalz/Monitoring/messketten/BWB_Brunnen_Prozessdaten</span></span>
<span></span>
<span></span>
<span><span class="va">xlsx_file</span> <span class="op">&lt;-</span> <span class="fu">kwb.nextcloud</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.nextcloud/man/download_files.html" class="external-link">download_files</a></span><span class="op">(</span>hrefs <span class="op">=</span> <span class="va">well_op_file</span><span class="op">$</span><span class="va">href</span>,</span>
<span>                                           target_dir <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">export_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; Downloading /remote.php/dav/files/hsonne/projects/GeoSalz/Monitoring/messketten/BWB_Brunnen_Prozessdaten/FRI%20-%20K%20-%20Brunnenlaufzeiten%20und%20Q%20(Export%20f%c3%bcr%20KWB)2024-11-18.xlsx ... ok. (0.73 secs)</span></span>
<span></span>
<span><span class="va">well_op_data</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">xlsx_file</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">menge_summe_m3</span> <span class="op">&lt;</span> <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">separate_name_der_messstelle_gms</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">string</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  wasserwerk <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">string</span>, <span class="fl">1L</span>, <span class="fl">3L</span><span class="op">)</span>,</span>
<span>  galerie <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">string</span>, <span class="fl">4L</span>, <span class="fl">4L</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  brunnen_nummer <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">string</span>, <span class="fl">5L</span>, <span class="fl">9L</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  unbekannter_buchstabe <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">string</span>, <span class="fl">10L</span>, <span class="fl">10L</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  brunnen_baujahr <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">string</span>, <span class="fl">12L</span>, <span class="fl">15L</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  brunnen_bauart <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">string</span>, <span class="fl">16L</span>, <span class="fl">16L</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">well_op_data_meta</span> <span class="op">&lt;-</span> <span class="va">well_op_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="fu">separate_name_der_messstelle_gms</span><span class="op">(</span><span class="va">well_op_data</span><span class="op">$</span><span class="va">name_der_messstelle_gms</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="make-combined-ec-and-well-operation-plot">Make combined EC and well operation plot<a class="anchor" aria-label="anchor" href="#make-combined-ec-and-well-operation-plot"></a>
</h3>
<p>and upload on cloud.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">well_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">13</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pdf_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"mc_and_q_well-%02d.pdf"</span>, <span class="va">well_ids</span><span class="op">)</span></span>
<span></span>
<span><span class="va">target_dir</span> <span class="op">&lt;-</span> <span class="st">"."</span></span>
<span><span class="va">para</span> <span class="op">&lt;-</span> <span class="st">"Leitfaehigkeit"</span></span>
<span><span class="va">debug</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span><span class="co">### Make pdf for each well  </span></span>
<span><span class="va">pdf_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">well_ids</span>, <span class="kw">function</span><span class="op">(</span><span class="va">well_id</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">path</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">target_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"mc-%s_and_abstraction_well-%02d.pdf"</span>, </span>
<span>                                           <span class="va">para</span>,</span>
<span>                                           <span class="va">well_id</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu">kwb.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.utils/man/catAndRun.html" class="external-link">catAndRun</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Writting '%s' to '%s'"</span>, <span class="va">well_id</span>, <span class="va">path</span><span class="op">)</span>,</span>
<span>      expr <span class="op">=</span> <span class="op">{</span></span>
<span>        <span class="fu">kwb.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.utils/man/preparePdf.html" class="external-link">preparePdf</a></span><span class="op">(</span><span class="va">path</span>, landscape <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span>
<span>          <span class="fu">kwb.geosalz</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_measurementchain_and_well_operation.html">plot_measurementchain_and_well_operation</a></span><span class="op">(</span></span>
<span>            mc_dat <span class="op">=</span> <span class="va">mc_dat</span>,</span>
<span>            well_op_data_meta <span class="op">=</span> <span class="va">well_op_data_meta</span>,</span>
<span>            brunnen_nr <span class="op">=</span> <span class="va">well_id</span>,</span>
<span>            para <span class="op">=</span> <span class="va">para</span>,</span>
<span>            date_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-05-10"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">path</span></span>
<span>      <span class="op">}</span>, </span>
<span>      dbg <span class="op">=</span> <span class="va">debug</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Writting '9' to './mc-Leitfaehigkeit_and_abstraction_well-09.pdf' ...</span></span>
<span><span class="co">#&gt; Warning: Removed 16530 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; ok. (0.77 secs) </span></span>
<span><span class="co">#&gt; Writting '10' to './mc-Leitfaehigkeit_and_abstraction_well-10.pdf' ...</span></span>
<span><span class="co">#&gt; Warning: Removed 26112 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; ok. (0.70 secs) </span></span>
<span><span class="co">#&gt; Writting '13' to './mc-Leitfaehigkeit_and_abstraction_well-13.pdf' ...</span></span>
<span><span class="co">#&gt; Warning: Removed 14226 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; ok. (0.68 secs)</span></span>
<span>  </span>
<span><span class="co">### Upload pdf files on cloud </span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">file</span> <span class="kw">in</span>  <span class="va">pdf_files</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">kwb.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.utils/man/catAndRun.html" class="external-link">catAndRun</a></span><span class="op">(</span></span>
<span>    messageText <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Uploading file"</span>, <span class="va">file</span><span class="op">)</span>,</span>
<span>    expr <span class="op">=</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">kwb.nextcloud</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kwb.nextcloud/man/upload_file.html" class="external-link">upload_file</a></span><span class="op">(</span></span>
<span>      file <span class="op">=</span> <span class="va">file</span>, </span>
<span>      target_path <span class="op">=</span> <span class="va">paths</span><span class="op">$</span><span class="va">upload_dir</span></span>
<span>    <span class="op">)</span><span class="op">)</span>,</span>
<span>    dbg <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span><span class="op">}</span></span>
<span><span class="co">#&gt; Uploading file ./mc-Leitfaehigkeit_and_abstraction_well-09.pdf ... Uploading</span></span>
<span><span class="co">#&gt;   ./mc-Leitfaehigkeit_and_abstraction_well-09.pdf</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (0.83 secs) </span></span>
<span><span class="co">#&gt; ok. (1.13 secs) </span></span>
<span><span class="co">#&gt; Uploading file ./mc-Leitfaehigkeit_and_abstraction_well-10.pdf ... Uploading</span></span>
<span><span class="co">#&gt;   ./mc-Leitfaehigkeit_and_abstraction_well-10.pdf</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (0.81 secs) </span></span>
<span><span class="co">#&gt; ok. (1.12 secs) </span></span>
<span><span class="co">#&gt; Uploading file ./mc-Leitfaehigkeit_and_abstraction_well-13.pdf ... Uploading</span></span>
<span><span class="co">#&gt;   ./mc-Leitfaehigkeit_and_abstraction_well-13.pdf</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;   projects/GeoSalz/Monitoring/messketten ... ok. (0.75 secs) </span></span>
<span><span class="co">#&gt; ok. (1.07 secs)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://mrustl.de" class="external-link">Michael Rustler</a>, <a href="https://www.kompetenz-wasser.de/en/forschung/projekte/geosalz" class="external-link"><img src="https://www.kompetenz-wasser.de/media/pages/forschung/projekte/geosalz/8fbeee5cf8-1702890603/geosalz_logo_transparent_rgb.png" alt="Project GeoSalz" height="24"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
