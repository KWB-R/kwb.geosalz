<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workflow • kwb.geosalz</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Workflow">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kwb.geosalz</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/workflow.html">Workflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/KWB-R/kwb.geosalz">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Workflow</h1>
                        <h4 class="author">Michael Rustler</h4>
            
            <h4 class="date">2019-03-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/KWB-R/kwb.geosalz/blob/master/vignettes/workflow.Rmd"><code>vignettes/workflow.Rmd</code></a></small>
      <div class="hidden name"><code>workflow.Rmd</code></div>

    </div>

    
    
<div id="install-r-packages" class="section level1">
<h1 class="hasAnchor">
<a href="#install-r-packages" class="anchor"></a>1 Install R packages</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="cf">if</span> (<span class="op">!</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(<span class="st">"remotes"</span>)) {</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"remotes"</span>, <span class="dt">repos =</span> <span class="st">"https://cloud.r-project.org"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"kwb-r/kwb.geosalz"</span>, </a>
<a class="sourceLine" id="cb1-6" data-line-number="6">                         <span class="dt">dependencies =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="setup-the-project" class="section level1">
<h1 class="hasAnchor">
<a href="#setup-the-project" class="anchor"></a>2 Setup the project</h1>
<div id="define-paths" class="section level2">
<h2 class="hasAnchor">
<a href="#define-paths" class="anchor"></a>2.1 Define paths</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Define paths and resolve placeholders</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">paths &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="dt">servername =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.getenv">Sys.getenv</a></span>(<span class="st">"servername"</span>),</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="dt">root_server =</span> <span class="st">"//&lt;servername&gt;/processing"</span>,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="dt">project =</span> <span class="st">"geosalz"</span>,</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="dt">task =</span> <span class="st">"labor"</span>,</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="dt">processing =</span> <span class="st">"&lt;root&gt;/&lt;project&gt;/&lt;task&gt;"</span>,</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  <span class="dt">input_dir =</span> <span class="st">"&lt;processing&gt;/precleaned-data/v0.2"</span>,</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  <span class="dt">input_dir_meta =</span> <span class="st">"&lt;input_dir&gt;/META"</span>,</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  <span class="dt">export_dir =</span> <span class="st">"&lt;processing&gt;/precleaned-data/v0.3"</span>,</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  <span class="dt">export_dir_meta =</span> <span class="st">"&lt;export_dir&gt;/META"</span>,</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">  <span class="dt">cleaned_data_dir =</span> <span class="st">"&lt;processing&gt;/cleaned-data"</span>,</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">  <span class="dt">figures_dir =</span> <span class="st">"&lt;processing&gt;/figures"</span>,</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">  <span class="dt">foerdermengen =</span> <span class="st">"&lt;export_dir&gt;/2018-04-27 Rohwasser Bericht - Galeriefördermengen.xlsx"</span>,</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">  <span class="dt">parameters =</span> <span class="st">"&lt;export_dir_meta&gt;/2018-06-01 Lab Parameter.xlsx"</span>,</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">  <span class="dt">lookup_para =</span> <span class="st">"&lt;export_dir_meta&gt;/lookup_para.csv"</span>,</a>
<a class="sourceLine" id="cb2-17" data-line-number="17">  <span class="dt">sites =</span> <span class="st">"&lt;export_dir_meta&gt;/Info-Altdaten.xlsx"</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">)</a>
<a class="sourceLine" id="cb2-19" data-line-number="19"></a>
<a class="sourceLine" id="cb2-20" data-line-number="20">paths &lt;-<span class="st"> </span>kwb.utils<span class="op">::</span><span class="kw">resolve</span>(paths, <span class="dt">root =</span> <span class="st">"root_server"</span>)</a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#paths &lt;- kwb.utils::resolve(paths, root = "C:/projects")</span></a></code></pre></div>
</div>
<div id="check-input-directory" class="section level2">
<h2 class="hasAnchor">
<a href="#check-input-directory" class="anchor"></a>2.2 Check input directory</h2>
<p>Check if input directory selected above exists:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Check if input directory exists</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">input_dir &lt;-<span class="st"> </span>kwb.utils<span class="op">::</span><span class="kw">safePath</span>(kwb.utils<span class="op">::</span><span class="kw">selectElements</span>(paths, <span class="st">"input_dir"</span>))</a></code></pre></div>
</div>
<div id="check-export-directory" class="section level2">
<h2 class="hasAnchor">
<a href="#check-export-directory" class="anchor"></a>2.3 Check export directory</h2>
<p>Check and in case the export directory is not available create it:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Check if exists and if not create it</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="cf">if</span> (<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/files2">dir.exists</a></span>(paths<span class="op">$</span>export_dir)) {</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(<span class="st">"Creating export directory: %s"</span>, paths<span class="op">$</span>export_dir))</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/create.html">dir_create</a></span>(paths<span class="op">$</span>export_dir)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">export_dir &lt;-<span class="st"> </span>kwb.utils<span class="op">::</span><span class="kw">safePath</span>(kwb.utils<span class="op">::</span><span class="kw">selectElements</span>(paths, <span class="st">"export_dir"</span>))</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">## Convert xls to xlsx files</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">kwb.geosalz<span class="op">::</span><span class="kw">convert_xls_as_xlsx</span>(input_dir, </a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                                 export_dir)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">## Copy xlsx files </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">kwb.geosalz<span class="op">::</span><span class="kw">copy_xlsx_files</span>(input_dir, export_dir, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
</div>
<div id="data-import" class="section level1">
<h1 class="hasAnchor">
<a href="#data-import" class="anchor"></a>3 Data import</h1>
<div id="categorise-the-excel-files" class="section level2">
<h2 class="hasAnchor">
<a href="#categorise-the-excel-files" class="anchor"></a>3.1 Categorise the Excel Files</h2>
<p>Select files if they consist of:</p>
<ul>
<li><p>Header 1 (meta): with manually added metadata in an extra sheet</p></li>
<li><p>Header 1: single header tables</p></li>
<li><p>Header 2: two-row header tables or</p></li>
<li><p>Header 4: four row header tables</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># Get all xlsx files to be imported</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">files &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list.files">dir</a></span>(export_dir, <span class="st">".xlsx"</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">files_meta &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  <span class="st">"Meta Info"</span>,</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  <span class="st">"Header ident"</span>,</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">  <span class="st">"Parameter ident"</span>,</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">  <span class="st">"Parameter"</span>,</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">  <span class="st">"Info-Altdaten"</span>,</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">  <span class="st">"Brandenburg_Parameter_BWB_Stolpe"</span>,</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">  <span class="st">"Kopie von Brandenburg_Parameter_BWB_Stolpe"</span>,</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">  <span class="st">"2005-10BeschilderungProbenahmestellenGWWIII"</span>,</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">  <span class="st">"Bezeichnungen der Reinwasserstellen"</span>,</a>
<a class="sourceLine" id="cb6-15" data-line-number="15">  <span class="st">"ReinwasserNomenklatur"</span>,</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">  <span class="st">"Info zu Altdaten 1970-1998"</span>,</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">  <span class="st">"2018-06-01 Lab Parameter"</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18">)</a>
<a class="sourceLine" id="cb6-19" data-line-number="19"></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"></a>
<a class="sourceLine" id="cb6-23" data-line-number="23">files_header1_meta &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb6-24" data-line-number="24">  <span class="st">"FRI_Br_GAL_C_Einzelparameter"</span>,</a>
<a class="sourceLine" id="cb6-25" data-line-number="25">  <span class="st">"FRI_Roh_Rein_NH4+NO3_2001-2003"</span>,</a>
<a class="sourceLine" id="cb6-26" data-line-number="26">  <span class="st">"MTBE_2003-11_2004"</span>,</a>
<a class="sourceLine" id="cb6-27" data-line-number="27">  <span class="st">"Reinwasser_2003_Fe_Mn"</span>, ## unclean</a>
<a class="sourceLine" id="cb6-28" data-line-number="28">  <span class="st">"VC_CN_in Brunnen bis Aug_2005 "</span>, ## unclean</a>
<a class="sourceLine" id="cb6-29" data-line-number="29">  <span class="st">"Wuhlheide_Beelitzhof_Teildaten"</span> ## unclean</a>
<a class="sourceLine" id="cb6-30" data-line-number="30">)</a>
<a class="sourceLine" id="cb6-31" data-line-number="31"></a>
<a class="sourceLine" id="cb6-32" data-line-number="32">files_header1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb6-33" data-line-number="33">  <span class="st">"2018-04-11 Chlorid in Brunnen - Übersicht"</span>,</a>
<a class="sourceLine" id="cb6-34" data-line-number="34">  <span class="st">"2018-04-27 LIMS Reiw &amp; Rohw Sammel "</span>,</a>
<a class="sourceLine" id="cb6-35" data-line-number="35">  <span class="st">"2018-04-27 Rohwasser Bericht - Galeriefördermengen"</span></a>
<a class="sourceLine" id="cb6-36" data-line-number="36">)</a>
<a class="sourceLine" id="cb6-37" data-line-number="37"></a>
<a class="sourceLine" id="cb6-38" data-line-number="38"></a>
<a class="sourceLine" id="cb6-39" data-line-number="39">files_header4 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb6-40" data-line-number="40">  <span class="st">"STO Rohw_1999-6_2004"</span>,</a>
<a class="sourceLine" id="cb6-41" data-line-number="41">  <span class="st">"Wuhlheide_1999-2003_Okt - Neu"</span>,</a>
<a class="sourceLine" id="cb6-42" data-line-number="42">  <span class="st">"KAU_1999-Okt2003"</span></a>
<a class="sourceLine" id="cb6-43" data-line-number="43">)</a>
<a class="sourceLine" id="cb6-44" data-line-number="44"></a>
<a class="sourceLine" id="cb6-45" data-line-number="45"></a>
<a class="sourceLine" id="cb6-46" data-line-number="46">files_archive &lt;-<span class="st"> "Siebert"</span></a>
<a class="sourceLine" id="cb6-47" data-line-number="47"></a>
<a class="sourceLine" id="cb6-48" data-line-number="48">files_to_ignore &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb6-49" data-line-number="49">  files_meta, files_header1, files_header1_meta,</a>
<a class="sourceLine" id="cb6-50" data-line-number="50">  files_header4, files_archive</a>
<a class="sourceLine" id="cb6-51" data-line-number="51">)</a>
<a class="sourceLine" id="cb6-52" data-line-number="52"></a>
<a class="sourceLine" id="cb6-53" data-line-number="53">in_files_to_ignore &lt;-<span class="st"> </span>kwb.utils<span class="op">::</span><span class="kw">removeExtension</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/basename">basename</a></span>(files)) <span class="op">%in%</span><span class="st"> </span>files_to_ignore</a>
<a class="sourceLine" id="cb6-54" data-line-number="54"></a>
<a class="sourceLine" id="cb6-55" data-line-number="55">filepaths_header2 &lt;-<span class="st"> </span>files[<span class="op">!</span>in_files_to_ignore]</a></code></pre></div>
</div>
<div id="header-1-with-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#header-1-with-metadata" class="anchor"></a>3.2 Header 1 (with metadata)</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">cond1 &lt;-<span class="st"> </span>kwb.utils<span class="op">::</span><span class="kw">removeExtension</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/basename">basename</a></span>(files)) <span class="op">%in%</span><span class="st"> </span>files_header1_meta</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">filepaths_header1_meta &lt;-<span class="st"> </span>files[cond1]</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"> labor_list_1meta &lt;-<span class="st"> </span>kwb.geosalz<span class="op">::</span><span class="kw">import_labor</span>(</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    filepaths_header1_meta ,</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    export_dir,</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">    <span class="dt">func =</span> kwb.geosalz<span class="op">::</span>read_bwb_header1_meta</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb7-9" data-line-number="9"></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">  has_errors &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(labor_list_1meta, inherits, <span class="st">"try-error"</span>)</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">  <span class="co">#has_errors</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"></a>
<a class="sourceLine" id="cb7-14" data-line-number="14">  labor_df_1meta &lt;-<span class="st"> </span>data.table<span class="op">::</span><span class="kw">rbindlist</span>(</a>
<a class="sourceLine" id="cb7-15" data-line-number="15">    <span class="dt">l =</span> labor_list_1meta[<span class="op">!</span>has_errors],</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">    <span class="dt">fill =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17">  )</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">cond2 &lt;-<span class="st"> </span>labor_df_1meta<span class="op">$</span>OriginalName <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"el. Leitfähigkeit (25 °C)"</span>, <span class="st">"Chlorid"</span>, <span class="st">"Sulfat"</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  labor_df_1meta[cond2 <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(labor_df_1meta<span class="op">$</span>DataValue), ] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/se-deprecated.html">group_by_</a></span>(<span class="st">"OriginalName"</span>, <span class="st">"Meßstelle"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">n =</span> <span class="kw"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span>())</a></code></pre></div>
</div>
<div id="header-2" class="section level2">
<h2 class="hasAnchor">
<a href="#header-2" class="anchor"></a>3.3 Header 2</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">  labor_header2_list &lt;-<span class="st"> </span>kwb.geosalz<span class="op">::</span><span class="kw">import_labor</span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">    <span class="dt">files =</span> filepaths_header2,</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">    <span class="dt">export_dir =</span> export_dir,</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    <span class="dt">func =</span> kwb.geosalz<span class="op">::</span>read_bwb_header2</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  has_errors &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(labor_header2_list, inherits, <span class="st">"try-error"</span>)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  <span class="co">#has_errors</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb9-10" data-line-number="10">  labor_header2_df &lt;-<span class="st"> </span>data.table<span class="op">::</span><span class="kw">rbindlist</span>(</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">    <span class="dt">l =</span> labor_header2_list[<span class="op">!</span>has_errors],</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">    <span class="dt">fill =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13">  )</a></code></pre></div>
</div>
<div id="header-4" class="section level2">
<h2 class="hasAnchor">
<a href="#header-4" class="anchor"></a>3.4 Header 4</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">cond3 &lt;-<span class="st"> </span>kwb.utils<span class="op">::</span><span class="kw">removeExtension</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/basename">basename</a></span>(files)) <span class="op">%in%</span><span class="st"> </span>files_header4</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">filepaths_header4 &lt;-<span class="st"> </span>files[cond3]</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">labor_header4_list &lt;-<span class="st"> </span>kwb.geosalz<span class="op">::</span><span class="kw">import_labor</span>(</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">    <span class="dt">files =</span> filepaths_header4,</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">    <span class="dt">export_dir =</span> export_dir,</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">    <span class="dt">func =</span> kwb.geosalz<span class="op">::</span>read_bwb_header4</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb10-9" data-line-number="9"></a>
<a class="sourceLine" id="cb10-10" data-line-number="10">  has_errors &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(labor_header4_list, inherits, <span class="st">"try-error"</span>)</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">  has_errors</a>
<a class="sourceLine" id="cb10-12" data-line-number="12"></a>
<a class="sourceLine" id="cb10-13" data-line-number="13">  labor_header4_df &lt;-<span class="st"> </span>data.table<span class="op">::</span><span class="kw">rbindlist</span>(</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">    <span class="dt">l =</span> labor_header4_list[<span class="op">!</span>has_errors],</a>
<a class="sourceLine" id="cb10-15" data-line-number="15">    <span class="dt">fill =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16">  )</a></code></pre></div>
</div>
</div>
<div id="data-cleaning" class="section level1">
<h1 class="hasAnchor">
<a href="#data-cleaning" class="anchor"></a>4 Data cleaning</h1>
<div id="merging-header2-and-header4" class="section level2">
<h2 class="hasAnchor">
<a href="#merging-header2-and-header4" class="anchor"></a>4.1 Merging Header2 and Header4</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"> labor_all &lt;-<span class="st"> </span>data.table<span class="op">::</span><span class="kw">rbindlist</span>(</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">    <span class="dt">l =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">      <span class="dt">x1 =</span> labor_header2_df,</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">      <span class="dt">x2 =</span> labor_header4_df</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">    ),</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">    <span class="dt">fill =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  )</a></code></pre></div>
</div>
<div id="filtering" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering" class="anchor"></a>4.2 Filtering</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">labor_all &lt;-<span class="st"> </span>labor_all <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(.data<span class="op">$</span>DataValue)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">Date =</span> dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(<span class="dt">condition =</span> <span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(.data<span class="op">$</span>Datum),</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">        <span class="dt">true =</span> .data<span class="op">$</span>Datum,</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">        <span class="dt">false =</span>  .data<span class="op">$</span>Probenahme)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">      </span>### Some "Datum" rentries are missing in;</a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="st">      </span>### K-TL_LSW-Altdaten-Werke Teil 1\Werke Teil 1\Kaulsdorf\KAU_1999-Okt2003.xlsx</a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="st">      </span>### sheets: 66 KAU Rein 1999-2000, 65 KAU NordSüd 1999-2000</a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(.data<span class="op">$</span>Date)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(.data<span class="op">$</span>VariableName_org))</a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(labor_all)</a></code></pre></div>
</div>
<div id="reducing-dataset-by-adding-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#reducing-dataset-by-adding-metadata" class="anchor"></a>4.3 Reducing dataset by adding metadata</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">labordaten_ww &lt;-<span class="st"> </span>kwb.geosalz<span class="op">::</span><span class="kw">add_para_metadata</span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">    <span class="dt">df =</span> labor_all,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">    <span class="dt">lookup_para_path =</span> paths<span class="op">$</span>lookup_para,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">    <span class="dt">parameters_path =</span> paths<span class="op">$</span>parameters</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">  labordaten_ww &lt;-<span class="st"> </span>kwb.geosalz<span class="op">::</span><span class="kw">add_site_metadata</span>(</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">    <span class="dt">df =</span> labordaten_ww,</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">    <span class="dt">site_path =</span> paths<span class="op">$</span>sites</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">      <span class="dt">year =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(.data<span class="op">$</span>Date,<span class="dt">format =</span> <span class="st">'%Y'</span>)),</a>
<a class="sourceLine" id="cb13-13" data-line-number="13">      <span class="dt">DataValue =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(.data<span class="op">$</span>DataValue)</a>
<a class="sourceLine" id="cb13-14" data-line-number="14">    )</a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(labordaten_ww)</a></code></pre></div>
</div>
<div id="exporting-cleaned-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#exporting-cleaned-dataset" class="anchor"></a>5. Exporting cleaned dataset</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"> fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/create.html">dir_create</a></span>(paths<span class="op">$</span>cleaned_data_dir, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(<span class="st">"Export cleaned data to: %s"</span>, paths<span class="op">$</span>cleaned_data_dir))</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  foerdermengen_ww &lt;-<span class="st"> </span>kwb.geosalz<span class="op">::</span><span class="kw">get_foerdermengen</span>(paths<span class="op">$</span>foerdermengen)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(labordaten_ww, foerdermengen_ww,</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">    <span class="dt">file =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(paths<span class="op">$</span>cleaned_data_dir, <span class="st">"cleaned-data.Rds"</span>)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/write.table">write.csv2</a></span>(labordaten_ww,</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(paths<span class="op">$</span>cleaned_data_dir, <span class="st">"labordaten_ww.csv"</span>),</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">    <span class="dt">row.names =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb14-11" data-line-number="11">  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/write.table">write.csv2</a></span>(foerdermengen_ww,</a>
<a class="sourceLine" id="cb14-12" data-line-number="12">    <span class="dt">file =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(paths<span class="op">$</span>cleaned_data_dir, <span class="st">"foerdermengen_ww.csv"</span>),</a>
<a class="sourceLine" id="cb14-13" data-line-number="13">    <span class="dt">row.names =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14">  )</a></code></pre></div>
</div>
<div id="visualisation" class="section level2">
<h2 class="hasAnchor">
<a href="#visualisation" class="anchor"></a>6. Visualisation</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/create.html">dir_create</a></span>(paths<span class="op">$</span>figures_dir, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(<span class="st">"Export figures/plots to: %s"</span>, paths<span class="op">$</span>figures_dir))</a>
<a class="sourceLine" id="cb15-4" data-line-number="4"></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">  para_info &lt;-<span class="st"> </span>kwb.geosalz<span class="op">::</span><span class="kw">get_parameters_meta</span>(paths<span class="op">$</span>parameters)</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">  water_types &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Reinwasser"</span>, <span class="st">"Rohwasser"</span>)</a>
<a class="sourceLine" id="cb15-9" data-line-number="9"></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"></a>
<a class="sourceLine" id="cb15-11" data-line-number="11">  <span class="cf">for</span> (water_type <span class="cf">in</span> water_types) {</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">    pdf_file &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(</a>
<a class="sourceLine" id="cb15-13" data-line-number="13">      paths<span class="op">$</span>figures_dir,</a>
<a class="sourceLine" id="cb15-14" data-line-number="14">      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(</a>
<a class="sourceLine" id="cb15-15" data-line-number="15">        <span class="st">"Zeitreihen_Jahresmittelwerte_Werke_%s.pdf"</span>,</a>
<a class="sourceLine" id="cb15-16" data-line-number="16">        water_type</a>
<a class="sourceLine" id="cb15-17" data-line-number="17">      )</a>
<a class="sourceLine" id="cb15-18" data-line-number="18">    )</a>
<a class="sourceLine" id="cb15-19" data-line-number="19"></a>
<a class="sourceLine" id="cb15-20" data-line-number="20">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(<span class="st">"Creating plot:</span><span class="ch">\n</span><span class="st">%s</span><span class="ch">\n</span><span class="st">"</span>, pdf_file))</a>
<a class="sourceLine" id="cb15-21" data-line-number="21">    <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/pdf">pdf</a></span>(<span class="dt">file =</span> pdf_file, <span class="dt">width =</span> <span class="dv">14</span>, <span class="dt">height =</span> <span class="dv">9</span>)</a>
<a class="sourceLine" id="cb15-22" data-line-number="22">    <span class="cf">for</span> (sel_para_id <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(labordaten_ww<span class="op">$</span>para_id)) {</a>
<a class="sourceLine" id="cb15-23" data-line-number="23">      my_selection &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(</a>
<a class="sourceLine" id="cb15-24" data-line-number="24">        <span class="st">"%s (%s)"</span>,</a>
<a class="sourceLine" id="cb15-25" data-line-number="25">        para_info<span class="op">$</span>para_kurzname[para_info<span class="op">$</span>para_id <span class="op">==</span><span class="st"> </span>sel_para_id],</a>
<a class="sourceLine" id="cb15-26" data-line-number="26">        water_type</a>
<a class="sourceLine" id="cb15-27" data-line-number="27">      )</a>
<a class="sourceLine" id="cb15-28" data-line-number="28"></a>
<a class="sourceLine" id="cb15-29" data-line-number="29">      tmp &lt;-<span class="st"> </span>labordaten_ww <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-30" data-line-number="30"><span class="st">        </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(prufgegenstand <span class="op">==</span><span class="st"> </span>water_type) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-31" data-line-number="31"><span class="st">        </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(para_id <span class="op">==</span><span class="st"> </span>sel_para_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-32" data-line-number="32"><span class="st">        </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(.data<span class="op">$</span>para_kurzname, .data<span class="op">$</span>werk, .data<span class="op">$</span>year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-33" data-line-number="33"><span class="st">        </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">mean_DataValue =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(.data<span class="op">$</span>DataValue), <span class="dt">na.rm=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-34" data-line-number="34"><span class="st">        </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(.data<span class="op">$</span>werk)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-35" data-line-number="35"><span class="st">        </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(</a>
<a class="sourceLine" id="cb15-36" data-line-number="36">          <span class="dt">y =</span> kwb.geosalz<span class="op">::</span><span class="kw">get_foerdermengen</span>(paths<span class="op">$</span>foerdermengen),</a>
<a class="sourceLine" id="cb15-37" data-line-number="37">          <span class="dt">by =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"werk"</span>, <span class="st">"year"</span>)</a>
<a class="sourceLine" id="cb15-38" data-line-number="38">        )</a>
<a class="sourceLine" id="cb15-39" data-line-number="39"></a>
<a class="sourceLine" id="cb15-40" data-line-number="40">      <span class="cf">if</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(tmp) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb15-41" data-line-number="41">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(<span class="st">"for %s</span><span class="ch">\n</span><span class="st">"</span>, my_selection))</a>
<a class="sourceLine" id="cb15-42" data-line-number="42"></a>
<a class="sourceLine" id="cb15-43" data-line-number="43">        g &lt;-<span class="st"> </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(tmp, <span class="dt">mapping =</span> ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span>(</a>
<a class="sourceLine" id="cb15-44" data-line-number="44">          <span class="dt">x =</span> <span class="st">"year"</span>,</a>
<a class="sourceLine" id="cb15-45" data-line-number="45">          <span class="dt">y =</span> <span class="st">"mean_DataValue"</span>,</a>
<a class="sourceLine" id="cb15-46" data-line-number="46">          <span class="dt">col =</span> <span class="st">"werk"</span></a>
<a class="sourceLine" id="cb15-47" data-line-number="47">        )) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-48" data-line-number="48"><span class="st">          </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-49" data-line-number="49"><span class="st">          </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-50" data-line-number="50"><span class="st">          </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-51" data-line-number="51"><span class="st">          </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="dt">label =</span> my_selection) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-52" data-line-number="52"><span class="st">          </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">x =</span> <span class="st">""</span>, <span class="dt">y =</span> <span class="st">"Jahresmittelwert"</span>)</a>
<a class="sourceLine" id="cb15-53" data-line-number="53"></a>
<a class="sourceLine" id="cb15-54" data-line-number="54">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(g)</a>
<a class="sourceLine" id="cb15-55" data-line-number="55">      } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb15-56" data-line-number="56">        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(</a>
<a class="sourceLine" id="cb15-57" data-line-number="57">          <span class="st">"not data availabe for %s</span><span class="ch">\n</span><span class="st">"</span>,</a>
<a class="sourceLine" id="cb15-58" data-line-number="58">          my_selection</a>
<a class="sourceLine" id="cb15-59" data-line-number="59">        ))</a>
<a class="sourceLine" id="cb15-60" data-line-number="60">      }</a>
<a class="sourceLine" id="cb15-61" data-line-number="61">    }</a>
<a class="sourceLine" id="cb15-62" data-line-number="62">    <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/dev">dev.off</a></span>()</a>
<a class="sourceLine" id="cb15-63" data-line-number="63">  }</a></code></pre></div>
</div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>7 Session Info</h1>
<div id="plattform" class="section level2">
<h2 class="hasAnchor">
<a href="#plattform" class="anchor"></a>Plattform</h2>
<table class="table">
<thead><tr class="header">
<th align="left">name</th>
<th align="left">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">version</td>
<td align="left">R version 3.5.2 (2017-01-27)</td>
</tr>
<tr class="even">
<td align="left">os</td>
<td align="left">Ubuntu 14.04.5 LTS</td>
</tr>
<tr class="odd">
<td align="left">system</td>
<td align="left">x86_64, linux-gnu</td>
</tr>
<tr class="even">
<td align="left">ui</td>
<td align="left">X11</td>
</tr>
<tr class="odd">
<td align="left">language</td>
<td align="left">(EN)</td>
</tr>
<tr class="even">
<td align="left">collate</td>
<td align="left">en_US.UTF-8</td>
</tr>
<tr class="odd">
<td align="left">ctype</td>
<td align="left">en_US.UTF-8</td>
</tr>
<tr class="even">
<td align="left">tz</td>
<td align="left">UTC</td>
</tr>
<tr class="odd">
<td align="left">date</td>
<td align="left">2019-03-02</td>
</tr>
</tbody>
</table>
</div>
<div id="packages" class="section level2">
<h2 class="hasAnchor">
<a href="#packages" class="anchor"></a>Packages</h2>
<pre><code>#&gt;  package     * version    date       lib source                          
#&gt;  assertthat    0.2.0      2017-04-11 [1] CRAN (R 3.5.2)                  
#&gt;  backports     1.1.3      2018-12-14 [1] CRAN (R 3.5.2)                  
#&gt;  cli           1.0.1      2018-09-25 [1] CRAN (R 3.5.2)                  
#&gt;  commonmark    1.7        2018-12-01 [1] CRAN (R 3.5.2)                  
#&gt;  crayon        1.3.4      2017-09-16 [1] CRAN (R 3.5.2)                  
#&gt;  desc          1.2.0      2018-05-01 [1] CRAN (R 3.5.2)                  
#&gt;  digest        0.6.18     2018-10-10 [1] CRAN (R 3.5.2)                  
#&gt;  dplyr       * 0.8.0.1    2019-02-15 [1] CRAN (R 3.5.2)                  
#&gt;  evaluate      0.13       2019-02-12 [1] CRAN (R 3.5.2)                  
#&gt;  fs            1.2.6      2018-08-23 [1] CRAN (R 3.5.2)                  
#&gt;  glue          1.3.0      2018-07-17 [1] CRAN (R 3.5.2)                  
#&gt;  htmltools     0.3.6      2017-04-28 [1] CRAN (R 3.5.2)                  
#&gt;  knitr         1.21       2018-12-10 [1] CRAN (R 3.5.2)                  
#&gt;  kwb.utils     0.4.0.9000 2019-02-13 [1] Github (KWB-R/kwb.utils@2b56680)
#&gt;  magrittr      1.5        2014-11-22 [1] CRAN (R 3.5.2)                  
#&gt;  MASS          7.3-51.1   2018-11-01 [3] CRAN (R 3.5.2)                  
#&gt;  memoise       1.1.0      2017-04-21 [1] CRAN (R 3.5.2)                  
#&gt;  pillar        1.3.1      2018-12-15 [1] CRAN (R 3.5.2)                  
#&gt;  pkgconfig     2.0.2      2018-08-16 [1] CRAN (R 3.5.2)                  
#&gt;  pkgdown       1.3.0      2018-12-07 [1] CRAN (R 3.5.2)                  
#&gt;  purrr         0.3.0      2019-01-27 [1] CRAN (R 3.5.2)                  
#&gt;  R6            2.4.0      2019-02-14 [1] CRAN (R 3.5.2)                  
#&gt;  Rcpp          1.0.0      2018-11-07 [1] CRAN (R 3.5.2)                  
#&gt;  rlang         0.3.1      2019-01-08 [1] CRAN (R 3.5.2)                  
#&gt;  rmarkdown     1.11       2018-12-08 [1] CRAN (R 3.5.2)                  
#&gt;  roxygen2      6.1.1      2018-11-07 [1] CRAN (R 3.5.2)                  
#&gt;  rprojroot     1.3-2      2018-01-03 [1] CRAN (R 3.5.2)                  
#&gt;  sessioninfo   1.1.1      2018-11-05 [1] CRAN (R 3.5.2)                  
#&gt;  stringi       1.3.1      2019-02-13 [1] CRAN (R 3.5.2)                  
#&gt;  stringr       1.4.0      2019-02-10 [1] CRAN (R 3.5.2)                  
#&gt;  tibble        2.0.1      2019-01-12 [1] CRAN (R 3.5.2)                  
#&gt;  tidyr       * 0.8.3      2019-03-01 [1] CRAN (R 3.5.2)                  
#&gt;  tidyselect    0.2.5      2018-10-11 [1] CRAN (R 3.5.2)                  
#&gt;  withr         2.1.2      2018-03-15 [1] CRAN (R 3.5.2)                  
#&gt;  xfun          0.5        2019-02-20 [1] CRAN (R 3.5.2)                  
#&gt;  xml2          1.2.0      2018-01-24 [1] CRAN (R 3.5.2)                  
#&gt;  yaml          2.2.0      2018-07-25 [1] CRAN (R 3.5.2)                  
#&gt; 
#&gt; [1] /home/travis/R/Library
#&gt; [2] /usr/local/lib/R/site-library
#&gt; [3] /home/travis/R-bin/lib/R/library</code></pre>
<div id="pandoc" class="section level3">
<h3 class="hasAnchor">
<a href="#pandoc" class="anchor"></a>Pandoc</h3>
<pre><code>#&gt;   pandoc_directory pandoc_version
#&gt; 1  /usr/bin/pandoc            2.2</code></pre>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#install-r-packages">1 Install R packages</a></li>
      <li>
<a href="#setup-the-project">2 Setup the project</a><ul class="nav nav-pills nav-stacked">
<li><a href="#define-paths">2.1 Define paths</a></li>
      <li><a href="#check-input-directory">2.2 Check input directory</a></li>
      <li><a href="#check-export-directory">2.3 Check export directory</a></li>
      </ul>
</li>
      <li>
<a href="#data-import">3 Data import</a><ul class="nav nav-pills nav-stacked">
<li><a href="#categorise-the-excel-files">3.1 Categorise the Excel Files</a></li>
      <li><a href="#header-1-with-metadata">3.2 Header 1 (with metadata)</a></li>
      <li><a href="#header-2">3.3 Header 2</a></li>
      <li><a href="#header-4">3.4 Header 4</a></li>
      </ul>
</li>
      <li>
<a href="#data-cleaning">4 Data cleaning</a><ul class="nav nav-pills nav-stacked">
<li><a href="#merging-header2-and-header4">4.1 Merging Header2 and Header4</a></li>
      <li><a href="#filtering">4.2 Filtering</a></li>
      <li><a href="#reducing-dataset-by-adding-metadata">4.3 Reducing dataset by adding metadata</a></li>
      <li><a href="#exporting-cleaned-dataset">5. Exporting cleaned dataset</a></li>
      <li><a href="#visualisation">6. Visualisation</a></li>
      </ul>
</li>
      <li>
<a href="#session-info">7 Session Info</a><ul class="nav nav-pills nav-stacked">
<li><a href="#plattform">Plattform</a></li>
      <li><a href="#packages">Packages</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://mrustl.de">Michael Rustler</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'd4835358fb23f26d15de35d9235143b6',
    indexName: 'kwb_geosalz',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
